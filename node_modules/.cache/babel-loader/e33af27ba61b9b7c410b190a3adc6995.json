{"ast":null,"code":"import common from \"../common/Config\";\nimport yaml2obj from 'js-yaml';\nimport json2yaml from 'json2yaml';\nimport { getNamespecelist } from \"@/api/namespace\";\nimport { DeleteStateFulSet, GetStateFulSet, GetStateFulSetDetail, UpdateStateFulSet } from \"@/api/statefulset\";\nexport default {\n  data() {\n    return {\n      //编辑器配置\n      cmOptions: common.cmOptions,\n      contentYaml: '',\n      //分页\n      currentPage: 1,\n      pagesize: 10,\n      pagesizeList: [10, 20, 30],\n      //\n      searchInput: '',\n      namespaceValue: 'default',\n      namespaceList: [],\n      appLoading: false,\n      statefulSetList: [],\n      statefulSetTotal: 0,\n      getStatefulSetsData: {\n        params: {\n          filter_name: '',\n          namespace: '',\n          page: '',\n          limit: ''\n        }\n      },\n      //详情\n      statefulSetDetail: {},\n      getStatefulSetDetailData: {\n        params: {\n          name: '',\n          namespace: ''\n        }\n      },\n      //yaml更新\n      yamlDialog: false,\n      updateStatefulSetData: {\n        params: {\n          namespace: '',\n          content: ''\n        }\n      },\n      //删除\n      delStatefulSetData: {\n        params: {\n          name: '',\n          namespace: ''\n        }\n      }\n    };\n  },\n\n  methods: {\n    transYaml(content) {\n      return json2yaml.stringify(content);\n    },\n\n    transObj(content) {\n      return yaml2obj.load(content);\n    },\n\n    onChange(val) {\n      this.contentYaml = val;\n    },\n\n    handleSizeChange(size) {\n      this.pagesize = size;\n      this.getStatefulSets();\n    },\n\n    handleCurrentChange(currentPage) {\n      this.currentPage = currentPage;\n      this.getStatefulSets();\n    },\n\n    handleClose(done) {\n      this.$confirm('确认关闭？').then(() => {\n        done();\n      }).catch(() => {});\n    },\n\n    ellipsis(value) {\n      return value.length > 15 ? value.substring(0, 15) + '...' : value;\n    },\n\n    timeTrans(timestamp) {\n      let date = new Date(new Date(timestamp).getTime() + 8 * 3600 * 1000);\n      date = date.toJSON();\n      date = date.substring(0, 19).replace('T', ' ');\n      return date;\n    },\n\n    restartTotal(e) {\n      let index,\n          sum = 0;\n      let containerStatuses = e.row.status.containerStatuses;\n\n      for (index in containerStatuses) {\n        sum = sum + containerStatuses[index].restartCount;\n      }\n\n      return sum;\n    },\n\n    getNamespaces() {\n      getNamespecelist().then(res => {\n        this.namespaceList = res.data.items;\n      }).catch(res => {\n        this.$message.error({\n          message: res.msg\n        });\n      });\n    },\n\n    getStatefulSets() {\n      this.appLoading = true;\n      this.getStatefulSetsData.params.filter_name = this.searchInput;\n      this.getStatefulSetsData.params.namespace = this.namespaceValue;\n      this.getStatefulSetsData.params.page = this.currentPage;\n      this.getStatefulSetsData.params.limit = this.pagesize;\n      GetStateFulSet(this.getStatefulSetsData.params).then(res => {\n        this.statefulSetList = res.data.items;\n        this.statefulSetTotal = res.data.total;\n      }).catch(res => {\n        this.$message.error({\n          message: res.msg\n        });\n      });\n      this.appLoading = false;\n    },\n\n    getStatefulSetDetail(e) {\n      this.getStatefulSetDetailData.params.name = e.row.metadata.name;\n      this.getStatefulSetDetailData.params.namespace = this.namespaceValue;\n      GetStateFulSetDetail(this.getStatefulSetDetailData.params).then(res => {\n        this.statefulSetDetail = res.data;\n        this.contentYaml = this.transYaml(this.statefulSetDetail);\n        this.yamlDialog = true;\n      }).catch(res => {\n        this.$message.error({\n          message: res.msg\n        });\n      });\n    },\n\n    updateStatefulSet() {\n      let content = JSON.stringify(this.transObj(this.contentYaml));\n      this.updateStatefulSetData.params.namespace = this.namespaceValue;\n      this.updateStatefulSetData.params.content = content;\n      UpdateStateFulSet(this.updateStatefulSetData.params).then(res => {\n        this.$message.success({\n          message: res.msg\n        });\n      }).catch(res => {\n        this.$message.error({\n          message: res.msg\n        });\n      });\n      this.yamlDialog = false;\n    },\n\n    delStatefulSet(e) {\n      this.delStatefulSetData.params.name = e.row.metadata.name;\n      this.delStatefulSetData.params.namespace = this.namespaceValue;\n      DeleteStateFulSet(this.delStatefulSetData.params).then(res => {\n        this.getStatefulSets();\n        this.$message.success({\n          message: res.msg\n        });\n      }).catch(res => {\n        this.$message.error({\n          message: res.msg\n        });\n      });\n    },\n\n    handleConfirm(obj, operateName, fn) {\n      this.confirmContent = '确认继续 ' + operateName + ' 操作吗？';\n      this.$confirm(this.confirmContent, '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消'\n      }).then(() => {\n        fn(obj);\n      }).catch(() => {\n        this.$message.info({\n          message: '已取消操作'\n        });\n      });\n    }\n\n  },\n  watch: {\n    namespaceValue: {\n      handler() {\n        localStorage.setItem('namespace', this.namespaceValue);\n        this.currentPage = 1;\n        this.getStatefulSets();\n      }\n\n    }\n  },\n\n  beforeMount() {\n    if (localStorage.getItem('namespace') !== undefined && localStorage.getItem('namespace') !== null) {\n      this.namespaceValue = localStorage.getItem('namespace');\n    }\n\n    this.getNamespaces();\n    this.getStatefulSets();\n  }\n\n};","map":{"version":3,"mappings":"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","names":["common","yaml2obj","json2yaml","getNamespecelist","DeleteStateFulSet","GetStateFulSet","GetStateFulSetDetail","UpdateStateFulSet","data","cmOptions","contentYaml","currentPage","pagesize","pagesizeList","searchInput","namespaceValue","namespaceList","appLoading","statefulSetList","statefulSetTotal","getStatefulSetsData","params","filter_name","namespace","page","limit","statefulSetDetail","getStatefulSetDetailData","name","yamlDialog","updateStatefulSetData","content","delStatefulSetData","methods","transYaml","stringify","transObj","load","onChange","val","handleSizeChange","size","getStatefulSets","handleCurrentChange","handleClose","done","$confirm","then","catch","ellipsis","value","length","substring","timeTrans","timestamp","date","Date","getTime","toJSON","replace","restartTotal","e","index","sum","containerStatuses","row","status","restartCount","getNamespaces","res","items","$message","error","message","msg","total","getStatefulSetDetail","metadata","updateStatefulSet","JSON","success","delStatefulSet","handleConfirm","obj","operateName","fn","confirmContent","confirmButtonText","cancelButtonText","info","watch","handler","localStorage","setItem","beforeMount","getItem","undefined"],"sourceRoot":"","sources":["/Users/allen/kubemanage-web/src/views/statefulset/StatefulSet.vue"],"sourcesContent":["<template>\n  <div class=\"statefulset\">\n    <el-row>\n      <el-col :span=\"24\">\n        <div>\n          <el-card class=\"statefulset-head-card\" shadow=\"never\" :body-style=\"{padding:'10px'}\">\n            <el-row>\n              <el-col :span=\"6\">\n                <div>\n                  <span>命名空间: </span>\n                  <el-select v-model=\"namespaceValue\" filterable placeholder=\"请选择\">\n                    <el-option\n                        v-for=\"(item, index) in namespaceList\"\n                        :key=\"index\"\n                        :label=\"item.metadata.name\"\n                        :value=\"item.metadata.name\">\n                    </el-option>\n                  </el-select>\n                </div>\n              </el-col>\n              <el-col :span=\"2\" :offset=\"16\">\n                <div>\n                  <el-button style=\"border-radius:2px;\" icon=\"Refresh\" plain @click=\"getStatefulSets()\">刷新</el-button>\n                </div>\n              </el-col>\n            </el-row>\n          </el-card>\n        </div>\n      </el-col>\n      <el-col :span=\"24\">\n        <div>\n          <el-card class=\"statefulset-head-card\" shadow=\"never\" :body-style=\"{padding:'10px'}\">\n            <el-row>\n              <el-col :span=\"2\">\n                <div>\n                  <el-button disabled style=\"border-radius:2px;\" icon=\"Edit\" type=\"primary\">创建</el-button>\n                </div>\n              </el-col>\n              <el-col :span=\"6\">\n                <div>\n                  <el-input class=\"statefulset-head-search\" clearable placeholder=\"请输入\" v-model=\"searchInput\"></el-input>\n                  <el-button style=\"border-radius:2px;\" icon=\"Search\" type=\"primary\" plain @click=\"getStatefulSets()\">搜索</el-button>\n                </div>\n              </el-col>\n            </el-row>\n          </el-card>\n        </div>\n      </el-col>\n      <el-col :span=\"24\">\n        <div>\n          <el-card class=\"statefulset-body-card\" shadow=\"never\" :body-style=\"{padding:'5px'}\">\n            <el-table\n                style=\"width:100%;font-size:12px;margin-bottom:10px;\"\n                :data=\"statefulSetList\"\n                v-loading=\"appLoading\">\n              <el-table-column width=\"20\"></el-table-column>\n              <el-table-column align=left label=\"StatefulSet名\">\n                <template v-slot=\"scope\">\n                  <a class=\"statefulset-body-statefulsetname\">{{ scope.row.metadata.name }}</a>\n                </template>\n              </el-table-column>\n              <el-table-column align=center label=\"标签\">\n                <template v-slot=\"scope\">\n                  <div v-for=\"(val, key) in scope.row.metadata.labels\" :key=\"key\">\n                    <el-popover\n                        placement=\"right\"\n                        :width=\"200\"\n                        trigger=\"hover\"\n                        :content=\"key + ':' + val\">\n                      <template #reference>\n                        <el-tag style=\"margin-bottom: 5px\" type=\"warning\">{{ ellipsis(key + \":\" + val) }}</el-tag>\n                      </template>\n                    </el-popover>\n                  </div>\n                </template>\n              </el-table-column>\n              <el-table-column align=center label=\"容器组\">\n                <template v-slot=\"scope\">\n                  <span>{{ scope.row.status.currentReplicas>0?scope.row.status.currentReplicas:0  }} / {{ scope.row.spec.replicas>0?scope.row.spec.replicas:0 }} </span>\n                </template>\n              </el-table-column>\n              <el-table-column align=center min-width=\"100\" label=\"创建时间\">\n                <template v-slot=\"scope\">\n                  <el-tag type=\"info\">{{ timeTrans(scope.row.metadata.creationTimestamp) }} </el-tag>\n                </template>\n              </el-table-column>\n              <el-table-column align=center label=\"镜像\">\n                <template v-slot=\"scope\">\n                  <div v-for=\"(val, key) in scope.row.spec.template.spec.containers\" :key=\"key\">\n                    <el-popover\n                        placement=\"right\"\n                        :width=\"200\"\n                        trigger=\"hover\"\n                        :content=\"val.image\">\n                      <template #reference>\n                        <el-tag style=\"margin-bottom: 5px\">{{ ellipsis(val.image.split('/')[2]==undefined?val.image:val.image.split('/')[2]) }}</el-tag>\n                      </template>\n                    </el-popover>\n                  </div>\n                </template>\n              </el-table-column>\n              <el-table-column align=center label=\"操作\" width=\"200\">\n                <template v-slot=\"scope\">\n                  <el-button size=\"small\" style=\"border-radius:2px;\" icon=\"Edit\" type=\"primary\" plain @click=\"getStatefulSetDetail(scope)\">YAML</el-button>\n                  <el-button size=\"small\" style=\"border-radius:2px;\" icon=\"Delete\" type=\"danger\" @click=\"handleConfirm(scope, '删除', delStatefulSet)\">删除</el-button>\n                </template>\n              </el-table-column>\n            </el-table>\n            <el-pagination\n                class=\"statefulset-body-pagination\"\n                background\n                @size-change=\"handleSizeChange\"\n                @current-change=\"handleCurrentChange\"\n                :current-page=\"currentPage\"\n                :page-sizes=\"pagesizeList\"\n                :page-size=\"pagesize\"\n                layout=\"total, sizes, prev, pager, next, jumper\"\n                :total=\"statefulSetTotal\">\n            </el-pagination>\n          </el-card>\n        </div>\n      </el-col>\n    </el-row>\n    <el-dialog title=\"YAML信息\" v-model=\"yamlDialog\" width=\"45%\" top=\"5%\">\n      <codemirror\n          :value=\"contentYaml\"\n          border\n          :options=\"cmOptions\"\n          height=\"500\"\n          style=\"font-size:14px;\"\n          @change=\"onChange\"\n      ></codemirror>\n      <template #footer>\n                <span class=\"dialog-footer\">\n                    <el-button @click=\"yamlDialog = false\">取 消</el-button>\n                    <el-button type=\"primary\" @click=\"updateStatefulSet()\">更 新</el-button>\n                </span>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport common from \"../common/Config\";\nimport yaml2obj from 'js-yaml';\nimport json2yaml from 'json2yaml';\nimport {getNamespecelist} from \"@/api/namespace\";\nimport {DeleteStateFulSet, GetStateFulSet, GetStateFulSetDetail, UpdateStateFulSet} from \"@/api/statefulset\";\nexport default {\n  data() {\n    return {\n      //编辑器配置\n      cmOptions: common.cmOptions,\n      contentYaml: '',\n      //分页\n      currentPage: 1,\n      pagesize: 10,\n      pagesizeList: [10, 20, 30],\n      //\n      searchInput: '',\n      namespaceValue: 'default',\n      namespaceList: [],\n      appLoading: false,\n      statefulSetList: [],\n      statefulSetTotal: 0,\n      getStatefulSetsData: {\n        params: {\n          filter_name: '',\n          namespace: '',\n          page: '',\n          limit: '',\n        }\n      },\n      //详情\n      statefulSetDetail: {},\n      getStatefulSetDetailData: {\n        params: {\n          name: '',\n          namespace: ''\n        }\n      },\n      //yaml更新\n      yamlDialog: false,\n      updateStatefulSetData: {\n        params: {\n          namespace: '',\n          content: ''\n        }\n      },\n      //删除\n      delStatefulSetData: {\n        params: {\n          name: '',\n          namespace: '',\n        }\n      }\n    }\n  },\n  methods: {\n    transYaml(content) {\n      return json2yaml.stringify(content)\n    },\n    transObj(content) {\n      return yaml2obj.load(content)\n    },\n    onChange(val) {\n      this.contentYaml = val\n    },\n    handleSizeChange(size) {\n      this.pagesize = size;\n      this.getStatefulSets()\n    },\n    handleCurrentChange(currentPage) {\n      this.currentPage = currentPage;\n      this.getStatefulSets()\n    },\n    handleClose(done) {\n      this.$confirm('确认关闭？')\n          .then(() => {\n            done();\n          })\n          .catch(() => {});\n    },\n    ellipsis(value) {\n      return value.length>15?value.substring(0,15)+'...':value\n    },\n    timeTrans(timestamp) {\n      let date = new Date(new Date(timestamp).getTime() + 8 * 3600 * 1000)\n      date = date.toJSON();\n      date = date.substring(0, 19).replace('T', ' ')\n      return date\n    },\n    restartTotal(e) {\n      let index, sum = 0\n      let containerStatuses = e.row.status.containerStatuses\n      for ( index in containerStatuses) {\n        sum = sum + containerStatuses[index].restartCount\n      }\n      return sum\n    },\n    getNamespaces() {\n      getNamespecelist().then(res => {\n            this.namespaceList = res.data.items\n          })\n          .catch(res => {\n            this.$message.error({\n              message: res.msg\n            })\n          })\n    },\n    getStatefulSets() {\n      this.appLoading = true\n      this.getStatefulSetsData.params.filter_name = this.searchInput\n      this.getStatefulSetsData.params.namespace = this.namespaceValue\n      this.getStatefulSetsData.params.page = this.currentPage\n      this.getStatefulSetsData.params.limit = this.pagesize\n      GetStateFulSet(this.getStatefulSetsData.params)\n          .then(res => {\n            this.statefulSetList = res.data.items\n            this.statefulSetTotal = res.data.total\n          })\n          .catch(res => {\n            this.$message.error({\n              message: res.msg\n            })\n          })\n      this.appLoading = false\n    },\n    getStatefulSetDetail(e) {\n      this.getStatefulSetDetailData.params.name = e.row.metadata.name\n      this.getStatefulSetDetailData.params.namespace = this.namespaceValue\n      GetStateFulSetDetail(this.getStatefulSetDetailData.params)\n          .then(res => {\n            this.statefulSetDetail = res.data\n            this.contentYaml = this.transYaml(this.statefulSetDetail)\n            this.yamlDialog = true\n          })\n          .catch(res => {\n            this.$message.error({\n              message: res.msg\n            })\n          })\n    },\n    updateStatefulSet() {\n      let content = JSON.stringify(this.transObj(this.contentYaml))\n      this.updateStatefulSetData.params.namespace = this.namespaceValue\n      this.updateStatefulSetData.params.content = content\n      UpdateStateFulSet(this.updateStatefulSetData.params)\n          .then(res => {\n            this.$message.success({\n              message: res.msg\n            })\n          })\n          .catch(res => {\n            this.$message.error({\n              message: res.msg\n            })\n          })\n      this.yamlDialog = false\n    },\n    delStatefulSet(e) {\n      this.delStatefulSetData.params.name = e.row.metadata.name\n      this.delStatefulSetData.params.namespace = this.namespaceValue\n      DeleteStateFulSet(this.delStatefulSetData.params)\n          .then(res => {\n            this.getStatefulSets()\n            this.$message.success({\n              message: res.msg\n            })\n          })\n          .catch(res => {\n            this.$message.error({\n              message: res.msg\n            })\n          })\n    },\n    handleConfirm(obj, operateName, fn) {\n      this.confirmContent = '确认继续 ' + operateName + ' 操作吗？'\n      this.$confirm(this.confirmContent,'提示',{\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n      })\n          .then(() => {\n            fn(obj)\n          })\n          .catch(() => {\n            this.$message.info({\n              message: '已取消操作'\n            })\n          })\n    },\n  },\n  watch: {\n    namespaceValue: {\n      handler() {\n        localStorage.setItem('namespace', this.namespaceValue)\n        this.currentPage = 1\n        this.getStatefulSets()\n      }\n    },\n  },\n  beforeMount() {\n    if (localStorage.getItem('namespace') !== undefined && localStorage.getItem('namespace') !== null) {\n      this.namespaceValue = localStorage.getItem('namespace')\n    }\n    this.getNamespaces()\n    this.getStatefulSets()\n  }\n}\n</script>\n\n\n<style scoped>\n.statefulset-head-card,.statefulset-body-card {\n  border-radius: 1px;\n  margin-bottom: 5px;\n}\n.statefulset-head-search {\n  width:160px;\n  margin-right:10px;\n}\n.statefulset-body-statefulsetname {\n  color: #4795EE;\n}\n.statefulset-body-statefulsetname:hover {\n  color: rgb(84, 138, 238);\n  cursor: pointer;\n  font-weight: bold;\n}\n</style>"]},"metadata":{},"sourceType":"module"}