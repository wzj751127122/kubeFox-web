{"ast":null,"code":"const __default__ = {\n  name: \"SysOperationRecord\"\n};\nimport { deleteSysOperationRecord, getSysOperationRecordList, deleteSysOperationRecordByIds } from \"@/api/operatorAudit\";\nimport { formatDate } from \"@/utils/format\";\nimport { ref } from \"vue\";\nimport { ElMessage } from \"element-plus\";\nexport default /*#__PURE__*/Object.assign(__default__, {\n  setup(__props, {\n    expose\n  }) {\n    expose();\n    const loading = ref(true);\n    const page = ref(1);\n    const total = ref(0);\n    const pageSize = ref(10);\n    const tableData = ref([]);\n    const searchInfo = ref({});\n    const method = ref([\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"]);\n\n    const onReset = () => {\n      searchInfo.value = {};\n      getTableData();\n    }; // 条件搜索前端看此方法\n\n\n    const onSubmit = () => {\n      page.value = 1;\n      pageSize.value = 10;\n\n      if (searchInfo.value.status === \"\") {\n        searchInfo.value.status = null;\n      } // console.log(\"Sending query to getSysOperationRecordList:\", searchInfo.value);\n\n\n      getTableData();\n    }; // 分页\n\n\n    const handleSizeChange = val => {\n      pageSize.value = val;\n      getTableData();\n    };\n\n    const handleCurrentChange = val => {\n      page.value = val;\n      getTableData();\n    }; // 查询\n\n\n    const getTableData = async () => {\n      loading.value = true;\n      const table = await getSysOperationRecordList({\n        page: page.value,\n        pageSize: pageSize.value,\n        ...searchInfo.value\n      });\n\n      if (table) {\n        tableData.value = table.dalist;\n        total.value = table.total;\n        page.value = table.page;\n        pageSize.value = table.pageSize;\n        loading.value = false;\n      }\n    };\n\n    getTableData();\n    const deleteVisible = ref(false);\n    const multipleSelection = ref([]);\n\n    const handleSelectionChange = val => {\n      multipleSelection.value = val;\n    };\n\n    const onDelete = async () => {\n      const ids = [];\n      multipleSelection.value && multipleSelection.value.forEach(item => {\n        ids.push(item.id);\n      });\n      const res = await deleteSysOperationRecordByIds({\n        ids\n      });\n\n      if (res) {\n        ElMessage({\n          type: \"success\",\n          message: \"删除成功\"\n        });\n\n        if (tableData.value.length === ids.length && page.value > 1) {\n          page.value--;\n        }\n\n        deleteVisible.value = false;\n        getTableData();\n      }\n    };\n\n    const deleteSysOperationRecordFunc = async row => {\n      row.visible = false;\n      const res = await deleteSysOperationRecord(row.id);\n\n      if (res) {\n        ElMessage({\n          type: \"success\",\n          message: \"删除成功\"\n        });\n\n        if (tableData.value.length === 1 && page.value > 1) {\n          page.value--;\n        }\n\n        getTableData();\n      }\n    };\n\n    const fmtBody = value => {\n      try {\n        return JSON.parse(value);\n      } catch (err) {\n        return value;\n      }\n    };\n\n    const __returned__ = {\n      loading,\n      page,\n      total,\n      pageSize,\n      tableData,\n      searchInfo,\n      method,\n      onReset,\n      onSubmit,\n      handleSizeChange,\n      handleCurrentChange,\n      getTableData,\n      deleteVisible,\n      multipleSelection,\n      handleSelectionChange,\n      onDelete,\n      deleteSysOperationRecordFunc,\n      fmtBody,\n      deleteSysOperationRecord,\n      getSysOperationRecordList,\n      deleteSysOperationRecordByIds,\n      formatDate,\n      ref,\n      ElMessage\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n\n});","map":{"version":3,"mappings":"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","names":["name","deleteSysOperationRecord","getSysOperationRecordList","deleteSysOperationRecordByIds","formatDate","ref","ElMessage","loading","page","total","pageSize","tableData","searchInfo","method","onReset","value","getTableData","onSubmit","status","handleSizeChange","val","handleCurrentChange","table","dalist","deleteVisible","multipleSelection","handleSelectionChange","onDelete","ids","forEach","item","push","id","res","type","message","length","deleteSysOperationRecordFunc","row","visible","fmtBody","JSON","parse","err"],"sources":["/Users/allen/k8s-platform-fe/src/views/audit/AuditView.vue"],"sourcesContent":["<template>\n    <div>\n        <div class=\"gva-search-box\">\n            <el-card>\n                <el-form :inline=\"true\" :model=\"searchInfo\">\n                    <el-form-item label=\"请求方法\">\n                        <el-select v-model=\"searchInfo.method\" placeholder=\"请输入请求方法\">\n                            <el-option v-for=\"(item, index) in method\" :key=\"index\" :label=\"item\" :value=\"item\" />\n                        </el-select>\n                    </el-form-item>\n                    <el-form-item label=\"请求路径\">\n                        <el-input v-model=\"searchInfo.path\" placeholder=\"搜索条件\" />\n                    </el-form-item>\n                    <el-form-item label=\"结果状态码\">\n                        <el-input v-model=\"searchInfo.status\" placeholder=\"搜索条件\" />\n                    </el-form-item>\n                    <el-form-item>\n                        <el-button size=\"small\" type=\"primary\" icon=\"search\" @click=\"onSubmit\">查询</el-button>\n                        <el-button size=\"small\" icon=\"refresh\" @click=\"onReset\">重置</el-button>\n                    </el-form-item>\n                </el-form>\n            </el-card>\n        </div>\n        <div class=\"gva-table-box mt-2\">\n            <el-card>\n                <div>\n                    <el-popover v-model=\"deleteVisible\" placement=\"top\" width=\"160\">\n                        <p>确定要删除吗？</p>\n                        <div style=\"text-align: right; margin-top: 8px\">\n                            <el-button size=\"small\" type=\"primary\" link @click=\"deleteVisible = false\">取消</el-button>\n                            <el-button size=\"small\" type=\"primary\" @click=\"onDelete\">确定</el-button>\n                        </div>\n                        <template #reference>\n                            <el-button icon=\"delete\" size=\"small\" style=\"margin-left: 10px\"\n                                :disabled=\"!multipleSelection.length\" @click=\"deleteVisible = true\">删除</el-button>\n                        </template>\n                    </el-popover>\n                </div>\n                <el-table v-loading=\"loading\" ref=\"multipleTable\" :data=\"tableData\" style=\"width: 100%\"\n                    tooltip-effect=\"dark\" row-key=\"id\" @selection-change=\"handleSelectionChange\">\n                    <el-table-column align=\"left\" type=\"selection\" width=\"55\" />\n                    <el-table-column align=\"center\" label=\"操作人\" width=\"200\">\n                        <template #default=\"scope\">\n                            <div>\n                                {{ scope.row.user.userName }}({{ scope.row.user.nickName }})\n                            </div>\n                        </template>\n                    </el-table-column>\n                    <el-table-column align=\"center\" label=\"创建时间\" width=\"180\">\n                        <template #default=\"scope\">{{\n                            formatDate(scope.row.created_at)\n                        }}</template>\n                    </el-table-column>\n                    <el-table-column align=\"center\" label=\"状态码\" prop=\"status\" width=\"120\">\n                        <template #default=\"scope\">\n                            <div>\n                                <el-tag type=\"success\">{{ scope.row.status }}</el-tag>\n                            </div>\n                        </template>\n                    </el-table-column>\n                    <el-table-column align=\"left\" label=\"请求IP\" prop=\"ip\" width=\"120\" />\n                    <el-table-column align=\"center\" label=\"请求方法\" prop=\"method\" width=\"120\" />\n                    <el-table-column align=\"center\" label=\"请求路径\" prop=\"path\" width=\"500\" />\n                    <el-table-column align=\"left\" label=\"请求\" prop=\"path\" width=\"80\">\n                        <template #default=\"scope\">\n                            <div>\n                                <el-popover v-if=\"scope.row.body\" placement=\"left-start\" trigger=\"click\">\n                                    <div class=\"popover-box\">\n                                        <pre>{{ fmtBody(scope.row.body) }}</pre>\n                                    </div>\n                                    <template #reference>\n                                        <el-icon style=\"cursor: pointer\">\n                                            <warning />\n                                        </el-icon>\n                                    </template>\n                                </el-popover>\n\n                                <span v-else>无</span>\n                            </div>\n                        </template>\n                    </el-table-column>\n                    <el-table-column align=\"left\" label=\"响应\" prop=\"path\" width=\"80\">\n                        <template #default=\"scope\">\n                            <div>\n                                <el-popover v-if=\"scope.row.resp\" placement=\"left-start\" trigger=\"click\">\n                                    <div class=\"popover-box\">\n                                        <pre>{{ fmtBody(scope.row.resp) }}</pre>\n                                    </div>\n                                    <template #reference>\n                                        <el-icon style=\"cursor: pointer\">\n                                            <warning />\n                                        </el-icon>\n                                    </template>\n                                </el-popover>\n                                <span v-else>无</span>\n                            </div>\n                        </template>\n                    </el-table-column>\n                    <el-table-column align=\"left\" label=\"操作\">\n                        <template #default=\"scope\">\n                            <el-popover v-model=\"scope.row.visible\" placement=\"top\" width=\"160\">\n                                <p>确定要删除吗？</p>\n                                <div style=\"text-align: right; margin-top: 8px\">\n                                    <el-button size=\"small\" type=\"primary\" link\n                                        @click=\"scope.row.visible = false\">取消</el-button>\n                                    <el-button size=\"small\" type=\"primary\"\n                                        @click=\"deleteSysOperationRecordFunc(scope.row)\">确定</el-button>\n                                </div>\n                                <template #reference>\n                                    <el-button icon=\"delete\" size=\"small\" type=\"primary\" link\n                                        @click=\"scope.row.visible = true\">删除</el-button>\n                                </template>\n                            </el-popover>\n                        </template>\n                    </el-table-column>\n                </el-table>\n                <div class=\"gva-pagination mt-2\">\n                    <el-pagination :current-page=\"page\" :page-size=\"pageSize\" :page-sizes=\"[10, 30, 50, 100]\" :total=\"total\"\n                        layout=\"total, sizes, prev, pager, next, jumper\" @current-change=\"handleCurrentChange\"\n                        @size-change=\"handleSizeChange\" />\n                </div>\n            </el-card>\n        </div>\n    </div>\n</template>\n  \n<script setup>\nimport {\n    deleteSysOperationRecord,\n    getSysOperationRecordList,\n    deleteSysOperationRecordByIds,\n} from \"@/api/operatorAudit\";\nimport { formatDate } from \"@/utils/format\";\nimport { ref } from \"vue\";\nimport { ElMessage } from \"element-plus\";\n\nconst loading = ref(true);\nconst page = ref(1);\nconst total = ref(0);\nconst pageSize = ref(10);\nconst tableData = ref([]);\nconst searchInfo = ref({});\nconst method = ref([\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"]);\nconst onReset = () => {\n    searchInfo.value = {};\n    getTableData();\n};\n// 条件搜索前端看此方法\nconst onSubmit = () => {\n    page.value = 1;\n    pageSize.value = 10;\n    if (searchInfo.value.status === \"\") {\n        searchInfo.value.status = null;\n    }\n    // console.log(\"Sending query to getSysOperationRecordList:\", searchInfo.value);\n    getTableData();\n};\n\n// 分页\nconst handleSizeChange = (val) => {\n    pageSize.value = val;\n    getTableData();\n};\n\nconst handleCurrentChange = (val) => {\n    page.value = val;\n    getTableData();\n};\n\n// 查询\nconst getTableData = async () => {\n    loading.value = true;\n    const table = await getSysOperationRecordList({\n        page: page.value,\n        pageSize: pageSize.value,\n        ...searchInfo.value,\n    });\n    if (table) {\n        tableData.value = table.dalist;\n        total.value = table.total;\n        page.value = table.page;\n        pageSize.value = table.pageSize;\n        loading.value = false;\n    }\n};\n\ngetTableData();\n\nconst deleteVisible = ref(false);\nconst multipleSelection = ref([]);\nconst handleSelectionChange = (val) => {\n    multipleSelection.value = val;\n};\nconst onDelete = async () => {\n    const ids = [];\n    multipleSelection.value &&\n        multipleSelection.value.forEach((item) => {\n            ids.push(item.id);\n        });\n    const res = await deleteSysOperationRecordByIds({ ids });\n    if (res) {\n        ElMessage({\n            type: \"success\",\n            message: \"删除成功\",\n        });\n        if (tableData.value.length === ids.length && page.value > 1) {\n            page.value--;\n        }\n        deleteVisible.value = false;\n        getTableData();\n    }\n};\nconst deleteSysOperationRecordFunc = async (row) => {\n    row.visible = false;\n    const res = await deleteSysOperationRecord(row.id);\n    if (res) {\n        ElMessage({\n            type: \"success\",\n            message: \"删除成功\",\n        });\n        if (tableData.value.length === 1 && page.value > 1) {\n            page.value--;\n        }\n        getTableData();\n    }\n};\nconst fmtBody = (value) => {\n    try {\n        return JSON.parse(value);\n    } catch (err) {\n        return value;\n    }\n};\n</script>\n  \n<script>\nexport default {\n    name: \"SysOperationRecord\",\n};\n</script>\n  \n<style lang=\"scss\">\n.table-expand {\n    padding-left: 60px;\n    font-size: 0;\n\n    label {\n        width: 90px;\n        color: #99a9bf;\n\n        .el-form-item {\n            margin-right: 0;\n            margin-bottom: 0;\n            width: 50%;\n        }\n    }\n}\n\n.popover-box {\n    background: #112435;\n    color: #f08047;\n    height: 600px;\n    width: 420px;\n    overflow: auto;\n}\n\n.popover-box::-webkit-scrollbar {\n    display: none;\n    /* Chrome Safari */\n}\n</style>\n  "]},"metadata":{},"sourceType":"module"}