{"ast":null,"code":"const __default__ = {\n  name: \"SysOperationRecord\"\n};\nimport { deleteSysOperationRecord, getSysOperationRecordList, deleteSysOperationRecordByIds } from \"~/api/sysOperationRecord\";\nimport { formatDate } from \"~/utils/format\";\nimport { ref } from \"vue\";\nimport { ElMessage } from \"element-plus\";\nexport default /*#__PURE__*/Object.assign(__default__, {\n  setup(__props, {\n    expose\n  }) {\n    expose();\n    const loading = ref(true);\n    const page = ref(1);\n    const total = ref(0);\n    const pageSize = ref(10);\n    const tableData = ref([]);\n    const searchInfo = ref({});\n    const method = ref([\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"]);\n\n    const onReset = () => {\n      searchInfo.value = {};\n      getTableData();\n    }; // 条件搜索前端看此方法\n\n\n    const onSubmit = () => {\n      page.value = 1;\n      pageSize.value = 10;\n\n      if (searchInfo.value.status === \"\") {\n        searchInfo.value.status = null;\n      }\n\n      getTableData();\n    }; // 分页\n\n\n    const handleSizeChange = val => {\n      pageSize.value = val;\n      getTableData();\n    };\n\n    const handleCurrentChange = val => {\n      page.value = val;\n      getTableData();\n    }; // 查询\n\n\n    const getTableData = async () => {\n      loading.value = true;\n      const table = await getSysOperationRecordList({\n        page: page.value,\n        pageSize: pageSize.value,\n        ...searchInfo.value\n      });\n\n      if (table) {\n        tableData.value = table.list;\n        total.value = table.total;\n        page.value = table.page;\n        pageSize.value = table.pageSize;\n        loading.value = false;\n      }\n    };\n\n    getTableData();\n    const deleteVisible = ref(false);\n    const multipleSelection = ref([]);\n\n    const handleSelectionChange = val => {\n      multipleSelection.value = val;\n    };\n\n    const onDelete = async () => {\n      const ids = [];\n      multipleSelection.value && multipleSelection.value.forEach(item => {\n        ids.push(item.id);\n      });\n      const res = await deleteSysOperationRecordByIds({\n        ids\n      });\n\n      if (res) {\n        ElMessage({\n          type: \"success\",\n          message: \"删除成功\"\n        });\n\n        if (tableData.value.length === ids.length && page.value > 1) {\n          page.value--;\n        }\n\n        deleteVisible.value = false;\n        getTableData();\n      }\n    };\n\n    const deleteSysOperationRecordFunc = async row => {\n      row.visible = false;\n      const res = await deleteSysOperationRecord(row.id);\n\n      if (res) {\n        ElMessage({\n          type: \"success\",\n          message: \"删除成功\"\n        });\n\n        if (tableData.value.length === 1 && page.value > 1) {\n          page.value--;\n        }\n\n        getTableData();\n      }\n    };\n\n    const fmtBody = value => {\n      try {\n        return JSON.parse(value);\n      } catch (err) {\n        return value;\n      }\n    };\n\n    const __returned__ = {\n      loading,\n      page,\n      total,\n      pageSize,\n      tableData,\n      searchInfo,\n      method,\n      onReset,\n      onSubmit,\n      handleSizeChange,\n      handleCurrentChange,\n      getTableData,\n      deleteVisible,\n      multipleSelection,\n      handleSelectionChange,\n      onDelete,\n      deleteSysOperationRecordFunc,\n      fmtBody,\n      deleteSysOperationRecord,\n      getSysOperationRecordList,\n      deleteSysOperationRecordByIds,\n      formatDate,\n      ref,\n      ElMessage\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n\n});","map":{"version":3,"mappings":"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","names":["name","deleteSysOperationRecord","getSysOperationRecordList","deleteSysOperationRecordByIds","formatDate","ref","ElMessage","loading","page","total","pageSize","tableData","searchInfo","method","onReset","value","getTableData","onSubmit","status","handleSizeChange","val","handleCurrentChange","table","list","deleteVisible","multipleSelection","handleSelectionChange","onDelete","ids","forEach","item","push","id","res","type","message","length","deleteSysOperationRecordFunc","row","visible","fmtBody","JSON","parse","err"],"sources":["/Users/allen/k8s-platform-fe/src/views/audit/AuditView.vue"],"sourcesContent":["<template>\n    <div>\n      <div class=\"gva-search-box\">\n        <el-card>\n          <el-form :inline=\"true\" :model=\"searchInfo\">\n            <el-form-item label=\"请求方法\">\n              <el-select v-model=\"searchInfo.method\" placeholder=\"请输入请求方法\">\n                <el-option\n                  v-for=\"(item, index) in method\"\n                  :key=\"index\"\n                  :label=\"item\"\n                  :value=\"item\"\n                />\n              </el-select>\n            </el-form-item>\n            <el-form-item label=\"请求路径\">\n              <el-input v-model=\"searchInfo.path\" placeholder=\"搜索条件\" />\n            </el-form-item>\n            <el-form-item label=\"结果状态码\">\n              <el-input v-model=\"searchInfo.status\" placeholder=\"搜索条件\" />\n            </el-form-item>\n            <el-form-item>\n              <el-button\n                size=\"small\"\n                type=\"primary\"\n                icon=\"search\"\n                @click=\"onSubmit\"\n                >查询</el-button\n              >\n              <el-button size=\"small\" icon=\"refresh\" @click=\"onReset\"\n                >重置</el-button\n              >\n            </el-form-item>\n          </el-form>\n        </el-card>\n      </div>\n      <div class=\"gva-table-box mt-2\">\n        <el-card>\n          <div>\n            <el-popover v-model=\"deleteVisible\" placement=\"top\" width=\"160\">\n              <p>确定要删除吗？</p>\n              <div style=\"text-align: right; margin-top: 8px\">\n                <el-button\n                  size=\"small\"\n                  type=\"primary\"\n                  link\n                  @click=\"deleteVisible = false\"\n                  >取消</el-button\n                >\n                <el-button size=\"small\" type=\"primary\" @click=\"onDelete\"\n                  >确定</el-button\n                >\n              </div>\n              <template #reference>\n                <el-button\n                  icon=\"delete\"\n                  size=\"small\"\n                  style=\"margin-left: 10px\"\n                  :disabled=\"!multipleSelection.length\"\n                  @click=\"deleteVisible = true\"\n                  >删除</el-button\n                >\n              </template>\n            </el-popover>\n          </div>\n          <el-table\n            v-loading=\"loading\"\n            ref=\"multipleTable\"\n            :data=\"tableData\"\n            style=\"width: 100%\"\n            tooltip-effect=\"dark\"\n            row-key=\"id\"\n            @selection-change=\"handleSelectionChange\"\n          >\n            <el-table-column align=\"left\" type=\"selection\" width=\"55\" />\n            <el-table-column align=\"center\" label=\"操作人\" width=\"200\">\n              <template #default=\"scope\">\n                <div>\n                  {{ scope.row.user.userName }}({{ scope.row.user.nickName }})\n                </div>\n              </template>\n            </el-table-column>\n            <el-table-column align=\"center\" label=\"创建时间\" width=\"180\">\n              <template #default=\"scope\">{{\n                formatDate(scope.row.created_at)\n              }}</template>\n            </el-table-column>\n            <el-table-column\n              align=\"center\"\n              label=\"状态码\"\n              prop=\"status\"\n              width=\"120\"\n            >\n              <template #default=\"scope\">\n                <div>\n                  <el-tag type=\"success\">{{ scope.row.status }}</el-tag>\n                </div>\n              </template>\n            </el-table-column>\n            <el-table-column align=\"left\" label=\"请求IP\" prop=\"ip\" width=\"120\" />\n            <el-table-column\n              align=\"center\"\n              label=\"请求方法\"\n              prop=\"method\"\n              width=\"120\"\n            />\n            <el-table-column\n              align=\"center\"\n              label=\"请求路径\"\n              prop=\"path\"\n              width=\"500\"\n            />\n            <el-table-column align=\"left\" label=\"请求\" prop=\"path\" width=\"80\">\n              <template #default=\"scope\">\n                <div>\n                  <el-popover\n                    v-if=\"scope.row.body\"\n                    placement=\"left-start\"\n                    trigger=\"click\"\n                  >\n                    <div class=\"popover-box\">\n                      <pre>{{ fmtBody(scope.row.body) }}</pre>\n                    </div>\n                    <template #reference>\n                      <el-icon style=\"cursor: pointer\"><warning /></el-icon>\n                    </template>\n                  </el-popover>\n  \n                  <span v-else>无</span>\n                </div>\n              </template>\n            </el-table-column>\n            <el-table-column align=\"left\" label=\"响应\" prop=\"path\" width=\"80\">\n              <template #default=\"scope\">\n                <div>\n                  <el-popover\n                    v-if=\"scope.row.resp\"\n                    placement=\"left-start\"\n                    trigger=\"click\"\n                  >\n                    <div class=\"popover-box\">\n                      <pre>{{ fmtBody(scope.row.resp) }}</pre>\n                    </div>\n                    <template #reference>\n                      <el-icon style=\"cursor: pointer\"><warning /></el-icon>\n                    </template>\n                  </el-popover>\n                  <span v-else>无</span>\n                </div>\n              </template>\n            </el-table-column>\n            <el-table-column align=\"left\" label=\"操作\">\n              <template #default=\"scope\">\n                <el-popover\n                  v-model=\"scope.row.visible\"\n                  placement=\"top\"\n                  width=\"160\"\n                >\n                  <p>确定要删除吗？</p>\n                  <div style=\"text-align: right; margin-top: 8px\">\n                    <el-button\n                      size=\"small\"\n                      type=\"primary\"\n                      link\n                      @click=\"scope.row.visible = false\"\n                      >取消</el-button\n                    >\n                    <el-button\n                      size=\"small\"\n                      type=\"primary\"\n                      @click=\"deleteSysOperationRecordFunc(scope.row)\"\n                      >确定</el-button\n                    >\n                  </div>\n                  <template #reference>\n                    <el-button\n                      icon=\"delete\"\n                      size=\"small\"\n                      type=\"primary\"\n                      link\n                      @click=\"scope.row.visible = true\"\n                      >删除</el-button\n                    >\n                  </template>\n                </el-popover>\n              </template>\n            </el-table-column>\n          </el-table>\n          <div class=\"gva-pagination mt-2\">\n            <el-pagination\n              :current-page=\"page\"\n              :page-size=\"pageSize\"\n              :page-sizes=\"[10, 30, 50, 100]\"\n              :total=\"total\"\n              layout=\"total, sizes, prev, pager, next, jumper\"\n              @current-change=\"handleCurrentChange\"\n              @size-change=\"handleSizeChange\"\n            />\n          </div>\n        </el-card>\n      </div>\n    </div>\n  </template>\n  \n  <script setup>\n  import {\n    deleteSysOperationRecord,\n    getSysOperationRecordList,\n    deleteSysOperationRecordByIds,\n  } from \"~/api/sysOperationRecord\";\n  import { formatDate } from \"~/utils/format\";\n  import { ref } from \"vue\";\n  import { ElMessage } from \"element-plus\";\n  \n  const loading = ref(true);\n  const page = ref(1);\n  const total = ref(0);\n  const pageSize = ref(10);\n  const tableData = ref([]);\n  const searchInfo = ref({});\n  const method = ref([\"GET\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\"]);\n  const onReset = () => {\n    searchInfo.value = {};\n    getTableData();\n  };\n  // 条件搜索前端看此方法\n  const onSubmit = () => {\n    page.value = 1;\n    pageSize.value = 10;\n    if (searchInfo.value.status === \"\") {\n      searchInfo.value.status = null;\n    }\n    getTableData();\n  };\n  \n  // 分页\n  const handleSizeChange = (val) => {\n    pageSize.value = val;\n    getTableData();\n  };\n  \n  const handleCurrentChange = (val) => {\n    page.value = val;\n    getTableData();\n  };\n  \n  // 查询\n  const getTableData = async () => {\n    loading.value = true;\n    const table = await getSysOperationRecordList({\n      page: page.value,\n      pageSize: pageSize.value,\n      ...searchInfo.value,\n    });\n    if (table) {\n      tableData.value = table.list;\n      total.value = table.total;\n      page.value = table.page;\n      pageSize.value = table.pageSize;\n      loading.value = false;\n    }\n  };\n  \n  getTableData();\n  \n  const deleteVisible = ref(false);\n  const multipleSelection = ref([]);\n  const handleSelectionChange = (val) => {\n    multipleSelection.value = val;\n  };\n  const onDelete = async () => {\n    const ids = [];\n    multipleSelection.value &&\n      multipleSelection.value.forEach((item) => {\n        ids.push(item.id);\n      });\n    const res = await deleteSysOperationRecordByIds({ ids });\n    if (res) {\n      ElMessage({\n        type: \"success\",\n        message: \"删除成功\",\n      });\n      if (tableData.value.length === ids.length && page.value > 1) {\n        page.value--;\n      }\n      deleteVisible.value = false;\n      getTableData();\n    }\n  };\n  const deleteSysOperationRecordFunc = async (row) => {\n    row.visible = false;\n    const res = await deleteSysOperationRecord(row.id);\n    if (res) {\n      ElMessage({\n        type: \"success\",\n        message: \"删除成功\",\n      });\n      if (tableData.value.length === 1 && page.value > 1) {\n        page.value--;\n      }\n      getTableData();\n    }\n  };\n  const fmtBody = (value) => {\n    try {\n      return JSON.parse(value);\n    } catch (err) {\n      return value;\n    }\n  };\n  </script>\n  \n  <script>\n  export default {\n    name: \"SysOperationRecord\",\n  };\n  </script>\n  \n  <style lang=\"scss\">\n  .table-expand {\n    padding-left: 60px;\n    font-size: 0;\n    label {\n      width: 90px;\n      color: #99a9bf;\n      .el-form-item {\n        margin-right: 0;\n        margin-bottom: 0;\n        width: 50%;\n      }\n    }\n  }\n  .popover-box {\n    background: #112435;\n    color: #f08047;\n    height: 600px;\n    width: 420px;\n    overflow: auto;\n  }\n  .popover-box::-webkit-scrollbar {\n    display: none; /* Chrome Safari */\n  }\n  </style>\n  "]},"metadata":{},"sourceType":"module"}